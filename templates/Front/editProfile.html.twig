{% extends 'base.html.twig' %}

{% block title %}Edit Profile | Eventopia{% endblock %}

{% block navbar %}
    <div style="background-color:white; margin-bottom:95px;">
        {% include 'Front/navbar.html.twig' %}
    </div>
{% endblock %}

{% block body %}
    <!-- Hero Banner -->
    <div class="container-fluid mt-5 mb-5" style="padding-left:4%; padding-right:4%;">
        <div style="width: 100%; text-align: center; margin-bottom: 50px;
        background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
        url('https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8cHJvZmlsZXxlbnwwfHwwfHx8MA%3D%3D');
        background-size: cover;
        background-position: center;
        padding: 100px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <h1 style="color: white; font-weight: bold; font-size: 3rem; margin-bottom: 20px;">Your Profile</h1>
            <p style="color: white; font-size: 1.5rem; margin-bottom: 30px;">
                Update your personal information
            </p>
        </div>
    </div>

    <!-- Profile Form -->
    <div class="container-fluid mb-5" style="padding-left:8%; padding-right:8%;">
        <div class="card mb-4" style="border-radius: 10px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <div class="card-body p-5">
                {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}
                
                <!-- Avatar Section -->
                <div class="text-center mb-5" style="position: relative;">
                    <div id="avatarCircle" style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; margin: 0 auto 20px; border: 4px solid #6e8efb; background-color: #f8f9fa; cursor: pointer;">
                        {% if user.imageurl %}
                            <img id="avatarPreview" 
                                 src="{{ asset( user.imageurl) }}" 
                                 style="width: 100%; height: 100%; object-fit: cover;"
                                 alt="Profile Picture"
                                 onerror="this.onerror=null;this.src='{{ asset('images/default-profile.png') }}'">
                        {% else %}
                            <img id="avatarPreview" 
                                 src="{{ asset('images/default-profile.png') }}" 
                                 style="width: 100%; height: 100%; object-fit: cover;"
                                 alt="Profile Picture">
                        {% endif %}
                    </div>
                    
                    <!-- Hidden file input (triggered by clicking the avatar) -->
                    <input type="file" id="user_imageFile_file" name="user[imageurl]" style="display: none;" accept="image/*">

                    <!-- Remove Image Button (only if the user has an image) -->
                    {% if user.imageurl %}
                        <button type="button" id="removeImageBtn" class="btn" style="background: #ff6b6b; color: white; padding: 8px 15px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none;">
                            <i class="fas fa-trash me-2"></i>Remove
                        </button>
                    {% endif %}
                    {{ form_widget(form.imageurl, {'attr': {'style': 'display: none;'}}) }}
                    <input type="hidden" id="removeImageFlag" name="remove_image" value="0">
                    
                    <h3 style="color: #1E293B; margin-top: 15px;">{{ user.prenom }} {{ user.nom }}</h3>
                </div>

                <!-- Rest of your form fields remain the same -->
                <!-- Personal Info -->
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        {{ form_row(form.nom, {
                            'label': 'Last Name',
                            'attr': {
                                'class': 'form-control',
                                'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC;'
                            },
                            'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                        }) }}
                    </div>
                    
                    <div class="col-md-6">
                        {{ form_row(form.prenom, {
                            'label': 'First Name',
                            'attr': {
                                'class': 'form-control',
                                'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC;'
                            },
                            'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                        }) }}
                    </div>
                    
                    <div class="col-md-6">
                        {{ form_row(form.email, {
                            'label': 'Email',
                            'attr': {
                                'class': 'form-control',
                                'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC;'
                            },
                            'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                        }) }}
                    </div>
                    
                    <div class="col-md-6">
                        {{ form_row(form.tel, {
                            'label': 'Phone',
                            'attr': {
                                'class': 'form-control',
                                'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC;'
                            },
                            'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                        }) }}
                    </div>
                    
                    <div class="col-12">
                        <div style="position: relative;">
                            {{ form_row(form.motdepasse, {
                                'label': 'Password',
                                'attr': {
                                    'class': 'form-control',
                                    'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC; padding-right: 40px;'
                                },
                                'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                            }) }}
                            <i class="fas fa-eye password-toggle" 
                               style="position: absolute; right: 15px; top: 40px; cursor: pointer; color: #6e8efb;"></i>
                        </div>
                    </div>
                </div>

                <!-- Address Section -->
                <div class="row g-4 mb-4">
                    <div class="col-12">
                        <h4 style="color: #6e8efb; border-bottom: 2px solid #6e8efb; padding-bottom: 8px; display: inline-block;">
                            <i class="fas fa-map-marker-alt me-2"></i>Address
                        </h4>
                    </div>
                    
                    <div class="col-md-6">
                        {{ form_row(form.adresse.region, {
                            'label': 'Region',
                            'attr': {
                                'class': 'form-control',
                                'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC;'
                            },
                            'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                        }) }}
                    </div>
                    
                    <div class="col-md-6">
                        {{ form_row(form.adresse.codePostal, {
                            'label': 'Postal Code',
                            'attr': {
                                'class': 'form-control',
                                'style': 'padding: 12px 15px; border-radius: 8px; border: 1px solid #E2E8F0; background-color: #F8FAFC;'
                            },
                            'label_attr': {'style': 'font-weight: 600; color: #1E293B; margin-bottom: 8px;'}
                        }) }}
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="d-flex justify-content-between mt-5 pt-4" style="border-top: 1px solid #E2E8F0;">
                    <a href="{{ path('app_home') }}" class="btn" style="background: white; color: #6e8efb; border: 1px solid #6e8efb; padding: 10px 25px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
                        <i class="fas fa-arrow-left me-2"></i>Cancel
                    </a>
                    <button type="submit" class="btn" style="background: #6e8efb; color: white; padding: 10px 25px; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const avatarCircle = document.getElementById('avatarCircle');
            const avatarInput = document.getElementById('user_imageFile_file');
            const avatarPreview = document.getElementById('avatarPreview');
            const removeImageBtn = document.getElementById('removeImageBtn');
            const removeImageFlag = document.getElementById('removeImageFlag');
            const defaultImage = "{{ asset('images/default-profile.png') }}";

            // Open file input when clicking on the avatar circle
            if (avatarCircle) {
                avatarCircle.addEventListener('click', function() {
                    avatarInput.click();  // Trigger the file input when the circle is clicked
                });
            }

            // Image upload preview
            if (avatarInput) {
                avatarInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            avatarPreview.src = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Remove image button
            if (removeImageBtn) {
                removeImageBtn.addEventListener('click', function() {
                    avatarPreview.src = defaultImage;
                    removeImageFlag.value = "1";  // Mark the image for removal
                    avatarInput.value = '';  // Clear the input
                });
            }
        });
    </script>
{% endblock %}
